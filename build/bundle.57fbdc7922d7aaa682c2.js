(()=>{"use strict";const e=document.querySelector(".profile__edit-button_action_open"),t=".elements",s=document.forms["profile-form"],r=document.forms["place-form"],n=document.querySelector(".popup_type_edit"),o=n.querySelector(".form__input_el_heading"),i=n.querySelector(".form__input_el_subheading"),l=document.querySelector(".profile__add-button_action_add"),p={submitSelector:".form__submit-button",inputSelector:".form__input",inputSectionSelector:".form__set",inputErrorSelector:".form__input-error",inputErrorClass:"form__input-error_active",formInputTypeError:"form__input_type_error",disabledButtonClass:"form__submit-button_inactive"};class u{constructor({items:e,renderer:t},s){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(s)}addItem(e){this._container.append(e)}renderItems(){Array.isArray(this._renderedItems)?this._renderedItems.forEach((e=>{this._renderer(e)})):this._renderer(this._renderedItems)}}class a{constructor(e,t){this._formElement=t,this._submitSelector=e.submitSelector,this._inputSelector=e.inputSelector,this._submitButton=this._formElement.querySelector(this._submitSelector),this._inputs=this._formElement.querySelectorAll(this._inputSelector),this._inputArray=Array.from(this._inputs),this._inputSectionSelector=e.inputSectionSelector,this._inputErrorSelector=e.inputErrorSelector,this._inputErrorClass=e.inputErrorClass,this._formInputTypeError=e.formInputTypeError,this._disabledButtonClass=e.disabledButtonClass}_showInputError=e=>{const t=this._formElement.querySelector(`.${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._inputErrorClass),e.classList.add(this._formInputTypeError)};_hideInputError=e=>{const t=this._formElement.querySelector(`.${e.id}-error`);t.textContent="",t.classList.remove(this._inputErrorClass),e.classList.remove(this._formInputTypeError)};hideAllInputError=()=>{this._inputs.forEach((e=>{const t=this._formElement.querySelector(`.${e.id}-error`);t.textContent="",t.classList.remove(this._inputErrorClass),e.classList.remove(this._formInputTypeError)}))};_toggleInputState=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e)};enableButton=()=>{this._submitButton.removeAttribute("disabled"),this._submitButton.classList.remove(this._disabledButtonClass)};disableButton=()=>{this._submitButton.setAttribute("disabled",!0),this._submitButton.classList.add(this._disabledButtonClass)};toggleButtonState=()=>{this._inputArray.every((e=>e.validity.valid))?this.enableButton():this.disableButton()};_setEventListeners=()=>{this.toggleButtonState(),this._formElement.addEventListener("reset",(()=>{this.disableButton()})),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputState(e),this.toggleButtonState()}))}))};enableValidation=()=>{this._setEventListeners()}}class _{constructor(e,t,{handleCardClick:s}){this._data=e,this._image=e.link,this._title=e.name,this._templateSelector=t,this._handleCardClick=s}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}_handleDeleteButton(){this._element.remove(),this._element=null}_handleLikeButton(){this._likeButton.classList.toggle("element__like_active")}_setEventListeners(){const e=this._element.querySelector(".element__trash");this._likeButton=this._element.querySelector(".element__like");const t=this._element.querySelector(".element__image");e.addEventListener("click",(()=>{this._handleDeleteButton()})),this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),t.addEventListener("click",(()=>{this._handleCardClick(this._data)}))}renderCard(){this._element=this._getTemplate();const e=this._element.querySelector(".element__image");return this._element.querySelector(".element__title").textContent=this._title,e.src=this._image,e.alt=`Картина: местность ${this._title}`,this._setEventListeners(),this._element}}class c{constructor(e){this._popup=document.querySelector(e)}openPopup(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose.bind(this))}closePopup(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose.bind(this))}_handleEscClose(e){"Escape"===e.key&&this.closePopup()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{e.target.classList.contains("popup_opened")&&this.closePopup(),e.target.classList.contains("popup__close")&&this.closePopup()}))}}class d extends c{constructor(e,{handleFormSubmit:t}){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".form__input")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}openPopup(){super.openPopup()}closePopup(){super.closePopup()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.closePopup(),this._form.reset()}))}}class m extends c{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image"),this._popupName=this._popup.querySelector(".popup__caption")}openPopup(e){this._popupImage.src=e.link,this._popupName.textContent=e.name,this._popupImage.alt=`Картина: местность ${e.name}`,super.openPopup(),super.setEventListeners()}}const h=new class{constructor({nameSelector:e,jobSelector:t}){this._name=document.querySelector(e),this._job=document.querySelector(t)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent}}setUserInfo({username:e,job:t}){this._name.textContent=e,this._job.textContent=t}}({nameSelector:".profile__title",jobSelector:".profile__text"}),S=e=>{const t=new _(e,"#card-template",{handleCardClick:e=>{new m(".popup_type_photo").openPopup(e)}});return t.renderCard()},b=new u({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=S(e);b.addItem(t)}},t);b.renderItems();const f={},y=e=>{const t=new a(p,e);t.enableValidation(),f[e.getAttribute("name")]=t};y(s),y(r);const E=new d(".popup_type_edit",{handleFormSubmit:e=>{h.setUserInfo(e),console.log(e),E.closePopup()}});E.setEventListeners(),e.addEventListener("click",(()=>{f[s.getAttribute("name")].enableButton(),f[s.getAttribute("name")].hideAllInputError();const e=h.getUserInfo();!function({username:e,job:t}){o.value=e,i.value=t}({username:e.name,job:e.job}),E.openPopup()}));const v=new d(".popup_type_place",{handleFormSubmit:e=>{const s=new u({items:e,renderer:e=>{const t=S(e);s.addItem(t)}},t);return s.renderItems()}});v.setEventListeners(),l.addEventListener("click",(()=>{v.openPopup()}))})();